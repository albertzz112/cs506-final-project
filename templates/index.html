<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Flight Delay Prediction Model</title>
    <script src="https://cdn.jsdelivr.net/npm/plotly.js-dist-min@2.14.0"></script>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='index.css') }}"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Jersey+10&display=swap"
      rel="stylesheet"
    />
  </head>

  <body>
    <h1>Flight Delay Prediction Model</h1>

    <h2>Dataset Description</h2>
    <p>{{ description }}</p>

    <h3>Dataset Head</h3>
    <div>{{ dataset_head | safe }}</div>

    <h2>Visualizations</h2>
    <div class="visualizations">
      <div class="left-chart">
        <h3>Distribution of Arrival Delays</h3>
        <div id="delay_dist_plot"></div>
        <script>
          var delayDistData = {{ delay_dist_plot | safe }};
          Plotly.newPlot('delay_dist_plot', delayDistData.data, delayDistData.layout);
        </script>
      </div>
      <div class="right-chart">
        <h3>Monthly Average Flight Delays</h3>
        <div id="monthly_delay_plot"></div>
        <script>
          var monthlyDelayData = {{ monthly_delay_plot | safe }};
          Plotly.newPlot('monthly_delay_plot', monthlyDelayData.data, monthlyDelayData.layout);
        </script>
      </div>
    </div>
    <h2>Data Cleaning & Processing</h2>
    <p>
      Data was cleaned by converting categorical features to 'category' dtype
      and handling missing values by imputation or removal where necessary.
    </p>

    <h2>Model Description</h2>
    <p>
      The model uses a CatBoostRegressor with the following configuration: 1000
      iterations, depth=6, learning rate=0.1, and a Tweedie loss function with
      variance power of 1.5.
    </p>

    <h2>Train the Model</h2>
    <button id="train_model_button">Train Model</button>
    <h3>Model Training Status</h3>
    <div id="model_output"></div>

    <script>
      document
        .getElementById("train_model_button")
        .addEventListener("click", function () {
          fetch("/train_model", {
            method: "POST",
          })
            .then((response) => response.json())
            .then((data) => {
              document.getElementById("model_output").innerHTML =
                "Training complete! RMSE: " +
                data.rmse.toFixed(4) +
                " | MSE: " +
                data.mse.toFixed(4);
            });
        });
    </script>

    <h3>Training Metrics</h3>
    <div id="training_plot"></div>
    <script>
      document
        .getElementById("train_model_button")
        .addEventListener("click", function () {
          fetch("/train_model", { method: "POST" })
            .then((response) => response.json())
            .then((data) => {
              document.getElementById("model_output").innerHTML =
                "Training complete! RMSE: " +
                data.rmse.toFixed(4) +
                " | MSE: " +
                data.mse.toFixed(4);

              // Render training plot
              var trainingPlotData = JSON.parse(data.training_plot);
              Plotly.newPlot(
                "training_plot",
                trainingPlotData.data,
                trainingPlotData.layout
              );
            });
        });
    </script>
  </body>
</html>
